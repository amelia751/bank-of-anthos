# =============================================================================
# AI-POWERED CREDIT PRE-APPROVAL FRONTEND SERVICE
# =============================================================================
# 
# This deployment creates a comprehensive frontend for the AI Credit Pre-Approval
# system, featuring real-time integration with all AI agents and dynamic data
# visualization.
#
# FEATURES:
# - Real-time AI agent orchestration visualization
# - Dynamic account data loading from Bank of Anthos services
# - Interactive credit offer presentation with personalized terms
# - Complete legal document generation and display
# - Responsive design optimized for financial applications
#
# ARCHITECTURE:
# - Frontend: Static HTML/CSS/JS served via Nginx
# - Backend API: Connects to reliable-backend service (34.123.3.178)
# - AI Agents: Risk, Terms, Perks, Challenger, Policy, MCP Server
# - Data Sources: Bank of Anthos microservices (userservice, balancereader, etc.)
#
# DEPLOYMENT:
# kubectl apply -f deployments/frontend/deploy-frontend-service.yaml
#
# =============================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: frontend-service-html
  namespace: default
  labels:
    app: frontend-service
    component: ai-credit-frontend
    version: v1.0.0
data:
  index.html: |
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AI Credit Pre-Approval - Bank of Anthos</title>
        <meta name="description" content="Get your personalized credit card offer powered by AI agents">
        
        <!-- External Dependencies -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
        
        <style>
            /* =================================================================== */
            /* GLOBAL STYLES & RESET */
            /* =================================================================== */
            * { 
                margin: 0; 
                padding: 0; 
                box-sizing: border-box; 
            }
            
            body { 
                font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
                background: #000000; 
                min-height: 100vh; 
                color: #ffffff; 
                line-height: 1.4; 
            }
            
            .container { 
                max-width: 1200px; 
                margin: 0 auto; 
                padding: 20px; 
            }

            /* =================================================================== */
            /* HEADER SECTION */
            /* =================================================================== */
            .header { 
                background: #1a1a1a; 
                border-radius: 16px; 
                padding: 40px 32px; 
                text-align: center; 
                margin-bottom: 24px; 
                border: 1px solid #333333; 
            }
            
            .header h1 { 
                font-size: 2rem; 
                font-weight: 600; 
                margin-bottom: 8px; 
                color: #ffffff; 
                letter-spacing: -0.02em; 
            }
            
            .header p { 
                font-size: 1rem; 
                color: #a1a1a1; 
                font-weight: 400; 
            }
            
            .header-icon { 
                width: 48px; 
                height: 48px; 
                background: #00d632; 
                border-radius: 12px; 
                display: inline-flex; 
                align-items: center; 
                justify-content: center; 
                margin-bottom: 16px; 
                font-size: 24px; 
                color: #000000; 
            }

            /* =================================================================== */
            /* DEMO SECTION & CARDS */
            /* =================================================================== */
            .demo-section { 
                margin-bottom: 24px; 
            }
            
            .ai-demo { 
                background: #1a1a1a; 
                border: 1px solid #333333; 
                border-radius: 16px; 
                padding: 24px; 
                margin-bottom: 24px; 
            }
            
            .ai-demo h2 { 
                font-size: 1.25rem; 
                font-weight: 600; 
                color: #ffffff; 
                margin-bottom: 12px; 
                letter-spacing: -0.01em; 
            }
            
            .ai-demo p { 
                color: #a1a1a1; 
                margin-bottom: 16px; 
                font-size: 0.95rem; 
            }

            /* =================================================================== */
            /* USER PROFILE & ACCOUNT DATA */
            /* =================================================================== */
            .user-profile { 
                display: grid; 
                grid-template-columns: 1fr 1fr; 
                gap: 16px; 
                margin: 24px 0; 
            }
            
            .profile-card { 
                background: #1a1a1a; 
                border: 1px solid #333333; 
                border-radius: 16px; 
                padding: 20px; 
                transition: all 0.2s ease; 
            }
            
            .profile-card:hover { 
                border-color: #00d632; 
                transform: translateY(-2px); 
            }
            
            .profile-card h3 { 
                color: #ffffff; 
                margin-bottom: 12px; 
                font-size: 1rem; 
                font-weight: 600; 
                display: flex; 
                align-items: center; 
                gap: 8px; 
            }
            
            .card-icon { 
                width: 20px; 
                height: 20px; 
                color: #00d632; 
            }

            /* =================================================================== */
            /* SPENDING ANALYSIS */
            /* =================================================================== */
            .spending-chart { 
                display: flex; 
                flex-wrap: wrap; 
                gap: 8px; 
                margin: 15px 0; 
            }
            
            .spending-item { 
                background: #333333; 
                color: #ffffff; 
                padding: 8px 12px; 
                border-radius: 16px; 
                font-size: 0.85em; 
                border: 1px solid #555555; 
                display: flex; 
                align-items: center; 
                gap: 6px; 
            }
            
            .spending-item i { 
                color: #00d632; 
                width: 12px; 
            }

            /* =================================================================== */
            /* AI ANALYSIS & INSIGHTS */
            /* =================================================================== */
            .ai-analysis { 
                background: #1a1a1a; 
                border: 1px solid #333333; 
                border-radius: 16px; 
                padding: 24px; 
                margin: 24px 0; 
                border-left: 4px solid #00d632; 
            }
            
            .ai-analysis h3 { 
                color: #ffffff; 
                font-size: 1.125rem; 
                font-weight: 600; 
                margin-bottom: 12px; 
                display: flex; 
                align-items: center; 
                gap: 8px; 
            }

            /* =================================================================== */
            /* CREDIT OFFERS */
            /* =================================================================== */
            .credit-offers { 
                display: grid; 
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
                gap: 16px; 
                margin: 24px 0; 
            }
            
            .offer-card { 
                background: #1a1a1a; 
                border: 1px solid #333333; 
                border-radius: 16px; 
                padding: 24px; 
                transition: all 0.2s ease; 
                position: relative; 
            }
            
            .offer-card:hover { 
                border-color: #00d632; 
                transform: translateY(-2px); 
            }
            
            .offer-card.approved { 
                border-color: #00d632; 
                background: #1a1a1a; 
            }
            
            .tier-badge { 
                display: inline-flex; 
                align-items: center; 
                gap: 6px; 
                padding: 6px 12px; 
                border-radius: 12px; 
                font-weight: 600; 
                font-size: 0.75rem; 
                margin-bottom: 16px; 
                text-transform: uppercase; 
                letter-spacing: 0.05em; 
            }
            
            .tier-approved { 
                background: #00d632; 
                color: #000000; 
            }

            /* =================================================================== */
            /* INTERACTIVE ELEMENTS */
            /* =================================================================== */
            .feature-list { 
                list-style: none; 
                margin: 15px 0; 
            }
            
            .feature-list li { 
                padding: 5px 0; 
                display: flex; 
                align-items: center; 
                gap: 10px; 
            }
            
            .feature-list li::before { 
                content: "✓"; 
                color: #4CAF50; 
                font-weight: bold; 
                width: 20px; 
            }
            
            .btn { 
                background: #00d632; 
                color: #000000; 
                border: none; 
                padding: 14px 24px; 
                border-radius: 24px; 
                cursor: pointer; 
                font-size: 0.9rem; 
                font-weight: 600; 
                transition: all 0.2s ease; 
                width: 100%; 
                margin-top: 16px; 
                letter-spacing: -0.01em; 
            }
            
            .btn:hover { 
                background: #00c42e; 
                transform: translateY(-1px); 
            }
            
            .btn-demo { 
                background: #00d632; 
                color: #000000; 
                margin: 24px auto; 
                padding: 16px 40px; 
                font-size: 1rem; 
                font-weight: 600; 
                border-radius: 32px; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                gap: 8px; 
                max-width: 300px; 
            }
            
            .btn-demo:hover { 
                background: #00c42e; 
                transform: translateY(-2px); 
            }

            /* =================================================================== */
            /* STATUS INDICATORS */
            /* =================================================================== */
            .status-indicator { 
                display: inline-flex; 
                align-items: center; 
                gap: 8px; 
                padding: 8px 12px; 
                border-radius: 16px; 
                font-size: 0.85em; 
                font-weight: 500; 
                margin: 4px 0; 
                background: #333333; 
                border: 1px solid #555555; 
            }
            
            .status-excellent { 
                background: #333333; 
                color: #00d632; 
                border-color: #00d632; 
            }
            
            .status-good { 
                background: #333333; 
                color: #ffa726; 
                border-color: #ffa726; 
            }
            
            .status-poor { 
                background: #333333; 
                color: #ff5722; 
                border-color: #ff5722; 
            }

            /* =================================================================== */
            /* EXPLANATIONS & CONTENT */
            /* =================================================================== */
            .explanation { 
                background: #333333; 
                border-radius: 12px; 
                padding: 16px; 
                margin: 15px 0; 
                border-left: 4px solid #00d632; 
            }
            
            .explanation p { 
                color: #a1a1a1; 
                line-height: 1.6; 
                margin: 0; 
            }
            
            .explanation em { 
                color: #ffffff; 
                font-style: normal; 
            }

            /* =================================================================== */
            /* LOADING STATES */
            /* =================================================================== */
            .loading { 
                display: none; 
                text-align: center; 
                padding: 20px; 
            }
            
            .spinner { 
                width: 40px; 
                height: 40px; 
                border: 4px solid #f3f3f3; 
                border-top: 4px solid #4CAF50; 
                border-radius: 50%; 
                animation: spin 1s linear infinite; 
                margin: 0 auto 10px; 
            }
            
            @keyframes spin { 
                0% { transform: rotate(0deg); } 
                100% { transform: rotate(360deg); } 
            }

            /* =================================================================== */
            /* POLICY & LEGAL DOCUMENTS */
            /* =================================================================== */
            .policy-section { 
                background: #1a1a1a; 
                border: 1px solid #333333; 
                border-radius: 16px; 
                padding: 24px; 
                margin: 24px 0; 
                border-left: 4px solid #9c27b0; 
            }
            
            .policy-section h3 { 
                color: #9c27b0; 
                font-size: 1.25rem; 
                font-weight: 600; 
                margin-bottom: 16px; 
                display: flex; 
                align-items: center; 
                gap: 8px; 
            }
            
            .document-grid { 
                display: grid; 
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
                gap: 16px; 
                margin: 20px 0; 
            }
            
            .document-card { 
                background: #2a2a2a; 
                border: 1px solid #444; 
                border-radius: 12px; 
                padding: 16px; 
                transition: all 0.2s ease; 
            }
            
            .document-card:hover { 
                border-color: #9c27b0; 
                transform: translateY(-2px); 
            }
            
            .document-title { 
                color: #ffffff; 
                font-weight: 600; 
                margin-bottom: 8px; 
                font-size: 0.9rem; 
                display: flex; 
                align-items: center; 
                gap: 8px; 
            }
            
            .document-preview { 
                color: #a1a1a1; 
                font-size: 0.8rem; 
                line-height: 1.4; 
                margin-bottom: 12px; 
                max-height: 60px; 
                overflow: hidden; 
            }
            
            .btn-secondary { 
                background: #333; 
                color: #fff; 
                border: 1px solid #555; 
                padding: 6px 12px; 
                border-radius: 16px; 
                font-size: 0.8rem; 
                cursor: pointer; 
                transition: all 0.2s ease; 
                width: 100%; 
            }
            
            .btn-secondary:hover { 
                background: #555; 
                border-color: #9c27b0; 
            }
            
            .compliance-badge { 
                display: inline-flex; 
                align-items: center; 
                gap: 6px; 
                padding: 6px 12px; 
                background: #4CAF50; 
                color: #000; 
                border-radius: 16px; 
                font-size: 0.8rem; 
                font-weight: 600; 
                margin-bottom: 16px; 
            }
            
            .signature-notice { 
                background: #ff9800; 
                color: #000; 
                padding: 12px; 
                border-radius: 8px; 
                text-align: center; 
                font-weight: 600; 
                font-size: 0.85rem; 
                margin: 16px 0; 
            }

            /* =================================================================== */
            /* RESPONSIVE DESIGN */
            /* =================================================================== */
            @media (max-width: 768px) { 
                .user-profile { 
                    grid-template-columns: 1fr; 
                } 
                .header h1 { 
                    font-size: 2em; 
                } 
                .demo-section { 
                    padding: 20px; 
                } 
            }
        </style>
    </head>
    <body>
        <!-- ================================================================= -->
        <!-- MAIN CONTAINER -->
        <!-- ================================================================= -->
        <div class="container">
            <!-- HEADER SECTION -->
            <div class="header">
                <div class="header-icon"><i class="fas fa-credit-card"></i></div>
                <h1>AI-Powered Credit Pre-Approval</h1>
                <p>Get your personalized credit card offer in seconds</p>
                <p>No credit check required • We analyze your spending patterns</p>
            </div>

            <!-- DEMO SECTION -->
            <div class="demo-section">
                <div class="ai-demo">
                    <h2><i class="fas fa-credit-card card-icon"></i> Ready for Your Personalized Credit Card Offer?</h2>
                    <p><strong>No credit history needed!</strong> Our AI analyzes your past transactions to create a credit card perfectly tailored to your spending habits.</p>
                    
                    <div style="margin: 20px 0;">
                        <h4><i class="fas fa-magic card-icon"></i> How It Works:</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Smart Analysis:</strong> We review your spending patterns and financial behavior</li>
                            <li><strong>AI Personalization:</strong> Our AI designs cashback rewards for your favorite merchants</li>
                            <li><strong>Instant Approval:</strong> Get your customized offer in seconds, not days</li>
                            <li><strong>Fair Terms:</strong> Competitive rates based on your actual financial habits</li>
                        </ul>
                    </div>

                    <button class="btn btn-demo" onclick="showAIDemo()">
                        <i class="fas fa-magic"></i>
                        Get My Personalized Offer
                    </button>
                </div>

                <!-- LOADING STATE -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>AI agents analyzing account data...</p>
                </div>

                <!-- RESULTS SECTION -->
                <div id="demo-results" style="display: none;">
                    <!-- USER PROFILE -->
                    <div class="user-profile">
                        <div class="profile-card">
                            <h3><i class="fas fa-chart-line card-icon"></i> Account Analysis</h3>
                            <div class="status-indicator status-excellent" id="account-status">
                                <span>●</span> Excellent Financial Health
                            </div>
                            <div style="margin: 15px 0; color: #a1a1a1;" id="account-details">
                                <strong>Current Balance:</strong> Loading...<br>
                                <strong>Monthly Spending:</strong> Loading...<br>
                                <strong>Transactions:</strong> Loading...<br>
                                <strong>Payment History:</strong> 100% reliable
                            </div>
                            
                            <h4><i class="fas fa-credit-card card-icon"></i> Spending Categories</h4>
                            <div class="spending-chart" id="spending-chart">
                                <div class="spending-item">
                                    <i class="fas fa-spinner fa-spin"></i> Loading your spending patterns...
                                </div>
                            </div>
                        </div>

                        <div class="profile-card">
                            <h3><i class="fas fa-brain card-icon"></i> AI Risk Assessment</h3>
                            <div style="font-size: 1.5em; color: #00d632; margin: 10px 0;" id="credit-score">
                                Credit Score: <strong>Loading...</strong>
                            </div>
                            <div class="tier-badge tier-approved" id="risk-tier">
                                <i class="fas fa-star"></i> LOADING...
                            </div>
                            
                            <h4><i class="fas fa-chart-bar card-icon"></i> Risk Factors Analysis:</h4>
                            <div style="margin: 10px 0;" id="risk-factors">
                                <div class="status-indicator">
                                    <i class="fas fa-spinner fa-spin"></i> Analyzing risk factors...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI DECISION SUMMARY -->
                    <div class="ai-analysis">
                        <h3><i class="fas fa-chart-line card-icon"></i> AI Decision Summary</h3>
                        <div class="explanation">
                            <p id="ai-decision-summary"><em><i class="fas fa-spinner fa-spin"></i> AI is analyzing your financial profile...</em></p>
                        </div>
                    </div>

                    <!-- CREDIT OFFERS -->
                    <h2><i class="fas fa-credit-card"></i> Personalized Credit Offers</h2>
                    <div class="credit-offers" id="credit-offers">
                        <div class="offer-card" style="text-align: center; padding: 40px;">
                            <div style="font-size: 1.2em; color: #a1a1a1; margin-bottom: 20px;">
                                <i class="fas fa-spinner fa-spin"></i> Loading personalized credit offers...
                            </div>
                            <p style="color: #666; font-size: 0.9em;">
                                AI is analyzing your spending patterns to create tailored financial products
                            </p>
                        </div>
                    </div>

                    <!-- POLICY DOCUMENTS -->
                    <div class="policy-section" id="policy-section" style="display: none;">
                        <h3><i class="fas fa-file-contract"></i> Legal Documents & Fine Print</h3>
                        <div class="compliance-badge">
                            <i class="fas fa-check-circle"></i>
                            <span id="compliance-score">100% Regulatory Compliant</span>
                        </div>
                        <div class="signature-notice">
                            <i class="fas fa-signature"></i> Electronic signature required for all documents below
                        </div>
                        <div class="document-grid" id="document-grid"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================================================================= -->
        <!-- JAVASCRIPT APPLICATION LOGIC -->
        <!-- ================================================================= -->
        <script>
            // =============================================================
            // CONFIGURATION & GLOBALS
            // =============================================================
            const API_BASE = 'http://34.55.9.100';  // Reliable backend service
            let fullData = null;  // Stores complete API response

            // =============================================================
            // MAIN APPLICATION ENTRY POINT
            // =============================================================
            /**
             * Initiates the AI demo by calling the backend API and orchestrating
             * all AI agents to provide personalized credit offers
             */
            async function showAIDemo() {
                console.log('🚀 Starting AI Demo...');
                
                // Hide demo button and show loading state
                document.querySelector('.btn-demo').style.display = 'none';
                document.getElementById('loading').style.display = 'block';
                
                try {
                    console.log('📞 Calling API:', API_BASE + '/api/real-preapproval?username=testuser&_t=' + Date.now());
                    
                    // Make API call with cache-busting and proper headers
                    const response = await fetch(API_BASE + '/api/real-preapproval?username=testuser&_t=' + Date.now(), {
                        method: 'GET',
                        headers: {
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('API response not OK: ' + response.status);
                    }
                    
                    fullData = await response.json();
                    console.log('✅ API Response received:', fullData);
                    
                    // Process AI insights if available
                    if (fullData.ai_insights) {
                        console.log('🤖 Processing AI insights...');
                        updateDemoResults(fullData);
                    } else {
                        console.error('❌ No AI insights data received');
                        showFallbackDemo();
                    }
                } catch (error) {
                    console.error('❌ Error fetching AI data:', error);
                    showFallbackDemo();
                }
                
                // Show results and scroll to them
                document.getElementById('loading').style.display = 'none';
                document.getElementById('demo-results').style.display = 'block';
                document.getElementById('demo-results').scrollIntoView({ behavior: 'smooth' });
            }
            
            // =============================================================
            // DATA PROCESSING & UI UPDATES
            // =============================================================
            /**
             * Updates all UI sections with real data from API response
             * @param {Object} data - Complete API response data
             */
            function updateDemoResults(data) {
                console.log('📊 Updating demo results with data:', data);
                
                // Update account details with real financial data
                if (data.current_balance && data.total_spending && data.transaction_count) {
                    console.log('💰 Updating account details...');
                    document.getElementById('account-details').innerHTML = 
                        '<strong>Current Balance:</strong> $' + data.current_balance.toFixed(2) + 
                        '<br><strong>Monthly Spending:</strong> $' + data.total_spending.toFixed(0) + 
                        '<br><strong>Transactions:</strong> ' + data.transaction_count + ' (last 6 months)' +
                        '<br><strong>Payment History:</strong> 100% reliable';
                }

                // Update account status based on credit score
                const accountStatus = document.getElementById('account-status');
                if (data.ai_assessment && data.ai_assessment.credit_score) {
                    console.log('📈 Updating account status...');
                    const creditScore = data.ai_assessment.credit_score;
                    if (creditScore >= 700) {
                        accountStatus.innerHTML = '<span>●</span> Excellent Financial Health';
                        accountStatus.className = 'status-indicator status-excellent';
                    } else if (creditScore >= 650) {
                        accountStatus.innerHTML = '<span>●</span> Good Financial Health';
                        accountStatus.className = 'status-indicator status-good';
                    } else {
                        accountStatus.innerHTML = '<span>●</span> Fair Financial Health';
                        accountStatus.className = 'status-indicator status-good';
                    }
                }

                // Update spending categories from transaction data
                if (data.spending_categories) {
                    console.log('🛒 Updating spending chart...');
                    updateSpendingChart(data.spending_categories);
                }

                // Update risk assessment from Risk Agent
                if (data.ai_insights && data.ai_insights.risk_assessment) {
                    console.log('⚠️ Updating risk assessment...');
                    updateRiskAssessment(data.ai_insights.risk_assessment);
                }

                // Update AI decision summary from Risk Agent
                if (data.ai_insights && data.ai_insights.risk_decision) {
                    console.log('🎯 Updating AI decision summary...');
                    updateAIDecisionSummary(data.ai_insights.risk_decision);
                } else if (data.ai_insights && data.ai_insights.final_decision) {
                    console.log('⚖️ Using final decision for summary...');
                    updateAIDecisionSummary(data.ai_insights.final_decision);
                }

                // Update credit offers from Terms Agent and Challenger Agent
                if (data.ai_insights && data.ai_insights.final_decision && data.ai_insights.final_decision.final_terms) {
                    console.log('💳 Updating credit offers...');
                    updateCreditOffers(data.ai_insights.final_decision.final_terms, data.ai_insights);
                }

                // Show and update policy documents from Policy Agent
                if (data.ai_insights && data.ai_insights.policy_documents) {
                    console.log('📜 Updating policy documents...');
                    updatePolicyDocuments(data.ai_insights.policy_documents);
                    document.getElementById('policy-section').style.display = 'block';
                }
            }

            /**
             * Updates spending chart with real transaction data
             * @param {Object} spendingCategories - Categorized spending data
             */
            function updateSpendingChart(spendingCategories) {
                const spendingChart = document.getElementById('spending-chart');
                spendingChart.innerHTML = '';
                
                // Icon mapping for spending categories
                const categoryIcons = {
                    'Coffee & Cafes': 'fas fa-coffee', 'Groceries': 'fas fa-shopping-cart', 'Gas & Fuel': 'fas fa-gas-pump',
                    'Restaurants': 'fas fa-utensils', 'Fast Casual': 'fas fa-hamburger', 'Online Retail': 'fas fa-laptop',
                    'Retail': 'fas fa-shopping-bag', 'Streaming Services': 'fas fa-play', 'Music Streaming': 'fas fa-music',
                    'Rideshare': 'fas fa-car', 'Electronics': 'fas fa-mobile-alt', 'Fitness & Health': 'fas fa-dumbbell',
                    'Other': 'fas fa-credit-card'
                };
                
                // Sort categories by spending amount and take top 6
                const sortedCategories = Object.entries(spendingCategories)
                    .filter(([category, data]) => data.total > 0)
                    .sort(([,a], [,b]) => b.total - a.total)
                    .slice(0, 6);
                
                if (sortedCategories.length === 0) {
                    spendingChart.innerHTML = '<div class="spending-item"><i class="fas fa-info-circle"></i> No spending data available</div>';
                    return;
                }
                
                // Create spending items
                sortedCategories.forEach(([category, data]) => {
                    const icon = categoryIcons[category] || 'fas fa-credit-card';
                    const spendingItem = document.createElement('div');
                    spendingItem.className = 'spending-item';
                    spendingItem.innerHTML = '<i class="' + icon + '"></i> ' + category + ': $' + data.total.toFixed(0);
                    spendingChart.appendChild(spendingItem);
                });
            }

            /**
             * Updates risk assessment display with AI Risk Agent data
             * @param {Object} riskData - Risk assessment data from Risk Agent
             */
            function updateRiskAssessment(riskData) {
                // Update credit score
                if (riskData.score) {
                    document.getElementById('credit-score').innerHTML = 'Credit Score: <strong>' + riskData.score + '</strong>';
                }

                // Update risk tier badge
                const tierBadge = document.getElementById('risk-tier');
                if (riskData.tier) {
                    if (riskData.tier === 'Gold') {
                        tierBadge.innerHTML = '<i class="fas fa-star"></i> GOLD TIER';
                        tierBadge.className = 'tier-badge tier-approved';
                    } else if (riskData.tier === 'Silver') {
                        tierBadge.innerHTML = '<i class="fas fa-star"></i> SILVER TIER';
                        tierBadge.className = 'tier-badge tier-approved';
                    } else {
                        tierBadge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> STANDARD TIER';
                        tierBadge.className = 'tier-badge tier-approved';
                    }
                }

                // Update risk factors analysis
                if (riskData.risk_factors) {
                    const riskFactorsContainer = document.getElementById('risk-factors');
                    riskFactorsContainer.innerHTML = '';

                    // Process risk factors into display format
                    const factors = [
                        { name: 'Income Stability', value: riskData.risk_factors.income_stability || 0 },
                        { name: 'Expense Management', value: 1 - (riskData.risk_factors.expense_ratio || 0) },
                        { name: 'Payment History', value: riskData.risk_factors.payment_reliability || 0 }
                    ];

                    factors.forEach(factor => {
                        const statusClass = factor.value > 0.7 ? 'status-excellent' : factor.value > 0.4 ? 'status-good' : 'status-poor';
                        const icon = factor.value > 0.7 ? 'fa-check-circle' : factor.value > 0.4 ? 'fa-exclamation-triangle' : 'fa-times-circle';
                        const status = factor.value > 0.7 ? 'Good' : factor.value > 0.4 ? 'Fair' : 'Risk';
                        
                        const statusDiv = document.createElement('div');
                        statusDiv.className = 'status-indicator ' + statusClass;
                        statusDiv.innerHTML = '<i class="fas ' + icon + '"></i> ' + factor.name + ': ' + status;
                        riskFactorsContainer.appendChild(statusDiv);
                    });
                }
            }

            /**
             * Updates AI decision summary with Risk Agent's approval decision
             * @param {Object} decisionData - Decision data from Risk Agent
             */
            function updateAIDecisionSummary(decisionData) {
                const summaryElement = document.getElementById('ai-decision-summary');
                
                // Handle Risk Agent decision format
                if (decisionData.decision) {
                    const decision = decisionData.decision;
                    const reasoning = decisionData.reasoning || 'Risk assessment completed';
                    const riskLevel = decisionData.risk_level || '';
                    
                    let decisionIcon = '🤖';
                    let decisionText = 'Processing application...';
                    
                    if (decision === 'APPROVED') {
                        decisionIcon = '✅';
                        decisionText = 'Application Approved!';
                    } else if (decision === 'CONDITIONAL_APPROVAL') {
                        decisionIcon = '⚠️';
                        decisionText = 'Conditional Approval';
                    } else if (decision === 'REJECTED') {
                        decisionIcon = '❌';
                        decisionText = 'Application Requires Review';
                    }
                    
                    const riskLevelText = riskLevel ? ' (' + riskLevel + ')' : '';
                    summaryElement.innerHTML = '<em><strong>' + decisionIcon + ' ' + decisionText + riskLevelText + '</strong><br><br>' + reasoning + '</em>';
                } 
                // Handle legacy arbiter decision format
                else if (decisionData.arbiter_decision) {
                    const decision = decisionData.arbiter_decision || 'processing';
                    const reason = decisionData.reason || 'Analyzing application...';
                    
                    let decisionIcon = '🤖';
                    let decisionText = 'Processing application...';
                    
                    if (decision.includes('approve')) {
                        decisionIcon = '✅';
                        decisionText = 'Application Approved!';
                    } else if (decision.includes('reject')) {
                        decisionIcon = '❌';
                        decisionText = 'Application needs review';
                    }
                    
                    summaryElement.innerHTML = '<em><strong>' + decisionIcon + ' ' + decisionText + '</strong><br><br>' + reason + '</em>';
                }
            }

            /**
             * Updates credit offers display with final terms from AI agents
             * @param {Object} finalTerms - Final terms from Terms Agent and Challenger Agent
             * @param {Object} aiInsights - Complete AI insights data
             */
            function updateCreditOffers(finalTerms, aiInsights) {
                const offersContainer = document.getElementById('credit-offers');
                offersContainer.innerHTML = '';

                // Extract perks data from both sources
                const originalPerks = aiInsights.perks && aiInsights.perks.perks ? aiInsights.perks.perks : {};
                const cardName = finalTerms.card_type || originalPerks.card_name || 'Bank of Anthos Credit Card';

                // Create offer card
                const offerCard = document.createElement('div');
                offerCard.className = 'offer-card approved';
                
                // Build rewards HTML - show ONLY the final approved terms (Arbiter's decision)
                let rewardsHTML = '';
                
                // Show enhanced reward structure from Challenger optimization
                if (finalTerms.reward_structure) {
                    const rewards = finalTerms.reward_structure;
                    rewardsHTML = '<h5 style="color: #00d632; margin: 16px 0 8px 0;"><i class="fas fa-percentage"></i> AI-Optimized Rewards</h5><ul class="feature-list">';
                    rewardsHTML += '<li>Base Rate: ' + (rewards.base_cashback || 1.0) + '% on all purchases</li>';
                    
                    // Show optimized bonus categories
                    if (rewards.bonus_categories) {
                        rewards.bonus_categories.forEach(function(cat) {
                            rewardsHTML += '<li>' + cat.rate + '% on ' + cat.category + ' (up to $' + cat.monthly_cap + '/month)</li>';
                        });
                    }
                    
                    // Show promotional offers
                    if (rewards.promotional_offers) {
                        rewards.promotional_offers.forEach(function(offer) {
                            rewardsHTML += '<li><strong>' + offer.title + ':</strong> ' + offer.description + '</li>';
                        });
                    }
                    
                    rewardsHTML += '</ul>';
                    
                    // Show premium benefits if available
                    if (rewards.premium_benefits && rewards.premium_benefits.length > 0) {
                        rewardsHTML += '<h6 style="color: #00d632; margin: 12px 0 6px 0;"><i class="fas fa-star"></i> Premium Benefits</h6><ul class="feature-list">';
                        rewards.premium_benefits.forEach(function(benefit) {
                            rewardsHTML += '<li>' + benefit + '</li>';
                        });
                        rewardsHTML += '</ul>';
                    }
                } else if (finalTerms.rewards) {
                    // Fallback for simpler reward structure
                    rewardsHTML = '<h5 style="color: #00d632; margin: 16px 0 8px 0;"><i class="fas fa-percentage"></i> Card Rewards</h5><ul class="feature-list">';
                    rewardsHTML += '<li>Base Rate: ' + (finalTerms.rewards.base_rate || 1.0) + '% on all purchases</li>';
                    
                    if (finalTerms.rewards.bonus_categories) {
                        finalTerms.rewards.bonus_categories.forEach(function(cat) {
                            rewardsHTML += '<li>' + cat.rate + '% on ' + cat.category + ' (up to $' + cat.monthly_cap + '/month)</li>';
                        });
                    } else if (finalTerms.rewards.bonus_category) {
                        rewardsHTML += '<li>' + finalTerms.rewards.bonus_category + '</li>';
                    }
                    
                    if (finalTerms.rewards.annual_bonus) {
                        rewardsHTML += '<li><strong>Annual Bonus:</strong> ' + finalTerms.rewards.annual_bonus + '</li>';
                    }
                    
                    rewardsHTML += '</ul>';
                }

                // Build perks HTML
                let perksHTML = '';
                if (finalTerms.engagement_perks && finalTerms.engagement_perks.digital_benefits) {
                    perksHTML = '<h5 style="color: #00d632; margin: 16px 0 8px 0;"><i class="fas fa-star"></i> Premium Benefits</h5><ul class="feature-list">';
                    finalTerms.engagement_perks.digital_benefits.slice(0, 4).forEach(function(benefit) {
                        perksHTML += '<li>' + benefit + '</li>';
                    });
                    perksHTML += '</ul>';
                }

                // Build complete offer card HTML
                offerCard.innerHTML = 
                    '<div class="tier-badge tier-approved"><i class="fas fa-robot"></i> AI-Approved Offer</div>' +
                    '<h3 style="color: #ffffff; margin-bottom: 16px;">' + cardName + '</h3>' +
                    '<div style="background: #2a2a2a; border-radius: 12px; padding: 16px; margin: 16px 0;">' +
                        '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; text-align: center;">' +
                            '<div><div style="font-size: 1.5rem; font-weight: 700; color: #00d632;">' + finalTerms.apr_rate + '%</div><div style="color: #a1a1a1; font-size: 0.85rem;">APR</div></div>' +
                            '<div><div style="font-size: 1.5rem; font-weight: 700; color: #00d632;">$' + (finalTerms.credit_limit ? finalTerms.credit_limit.toLocaleString() : 'N/A') + '</div><div style="color: #a1a1a1; font-size: 0.85rem;">Credit Limit</div></div>' +
                            '<div><div style="font-size: 1.5rem; font-weight: 700; color: #00d632;">$' + finalTerms.annual_fee + '</div><div style="color: #a1a1a1; font-size: 0.85rem;">Annual Fee</div></div>' +
                            '<div><div style="font-size: 1.5rem; font-weight: 700; color: #00d632;">' + finalTerms.grace_period_days + '</div><div style="color: #a1a1a1; font-size: 0.85rem;">Grace Period</div></div>' +
                        '</div>' +
                    '</div>' +
                    rewardsHTML +
                    perksHTML +
                    (finalTerms.promotional_offers ? '<div style="background: linear-gradient(135deg, #00d632, #00c42e); color: #000000; border-radius: 12px; padding: 16px; margin: 16px 0; font-weight: 600; text-align: center;"><i class="fas fa-gift"></i> ' + (finalTerms.promotional_offers[0] && finalTerms.promotional_offers[0].title ? finalTerms.promotional_offers[0].title : 'Special Offer Available') + '</div>' : '') +
                    '<button class="btn" onclick="proceedToApplication()"><i class="fas fa-credit-card"></i> Accept Offer & Apply</button>';

                offersContainer.appendChild(offerCard);
            }

            /**
             * Updates policy documents section with generated legal documents
             * @param {Object} policyData - Policy documents from Policy Agent
             */
            function updatePolicyDocuments(policyData) {
                const complianceScore = document.getElementById('compliance-score');
                const documentGrid = document.getElementById('document-grid');
                
                // Update compliance score
                if (policyData.compliance_check) {
                    complianceScore.textContent = policyData.compliance_check.compliance_score + '% Regulatory Compliant';
                }
                
                // Process documents
                if (policyData.documents) {
                    documentGrid.innerHTML = '';
                    
                    const documentIcons = {
                        'credit_card_agreement': 'fa-file-contract', 'terms_and_conditions': 'fa-file-alt',
                        'privacy_policy': 'fa-shield-alt', 'fee_schedule': 'fa-file-invoice-dollar',
                        'application_summary': 'fa-file-signature', 'regulatory_disclosures': 'fa-balance-scale'
                    };
                    
                    Object.entries(policyData.documents).forEach(function([docType, docData]) {
                        const docCard = document.createElement('div');
                        docCard.className = 'document-card';
                        
                        const icon = documentIcons[docType] || 'fa-file';
                        const title = docData.document_type || docType.replace(/_/g, ' ').toUpperCase();
                        const preview = docData.content ? docData.content.substring(0, 100).replace(/\\n/g, ' ') + '...' : 'Document content available';
                        
                        docCard.innerHTML = 
                            '<div class="document-title"><i class="fas ' + icon + '"></i>' + title + '</div>' +
                            '<div class="document-preview">' + preview + '</div>' +
                            '<button class="btn-secondary" onclick="viewDocument(\'' + docType + '\')"><i class="fas fa-eye"></i> View Full Document</button>';
                        
                        documentGrid.appendChild(docCard);
                    });
                }
            }

            // =============================================================
            // UTILITY FUNCTIONS
            // =============================================================
            /**
             * Displays full document content in a modal
             * @param {string} docType - Document type identifier
             */
            function viewDocument(docType) {
                if (!fullData || !fullData.ai_insights || !fullData.ai_insights.policy_documents || !fullData.ai_insights.policy_documents.documents || !fullData.ai_insights.policy_documents.documents[docType]) {
                    alert('Document not available');
                    return;
                }
                
                const doc = fullData.ai_insights.policy_documents.documents[docType];
                const content = doc.content || JSON.stringify(doc, null, 2);
                
                // Create modal
                const modal = document.createElement('div');
                modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;';
                
                modal.innerHTML = 
                    '<div style="background: #1a1a1a; border-radius: 16px; padding: 30px; max-width: 800px; max-height: 80vh; overflow-y: auto; border: 1px solid #333;">' +
                        '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">' +
                            '<h3 style="color: #fff; margin: 0;">' + (doc.document_type || docType) + '</h3>' +
                            '<button onclick="this.closest(\'div\').parentElement.remove()" style="background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; padding: 0;">&times;</button>' +
                        '</div>' +
                        '<div style="color: #a1a1a1; line-height: 1.6; white-space: pre-wrap; font-size: 0.9rem;">' + content.replace(/\\n/g, '\n') + '</div>' +
                    '</div>';
                
                document.body.appendChild(modal);
            }

            /**
             * Scrolls to policy section when user accepts offer
             */
            function proceedToApplication() {
                window.location.href = '#policy-section';
            }

            /**
             * Shows fallback demo when API is unavailable
             */
            function showFallbackDemo() {
                document.getElementById('ai-decision-summary').innerHTML = '<em>🤖 <strong>Demo Mode:</strong> AI analysis temporarily unavailable. Showing sample results.</em>';
            }

            // =============================================================
            // INITIALIZATION
            // =============================================================
            window.addEventListener('load', function() {
                console.log('🌐 AI Credit Pre-Approval Frontend loaded successfully!');
                console.log('🔗 API Base URL:', API_BASE);
                console.log('🤖 Ready to connect to AI agents...');
            });
        </script>
    </body>
    </html>

---
# =============================================================================
# KUBERNETES DEPLOYMENT CONFIGURATION
# =============================================================================

apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-service
  namespace: default
  labels:
    app: frontend-service
    component: ai-credit-frontend
    version: v1.0.0
spec:
  replicas: 2  # High availability with 2 replicas
  selector:
    matchLabels:
      app: frontend-service
  template:
    metadata:
      labels:
        app: frontend-service
        component: ai-credit-frontend
        version: v1.0.0
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80
          name: http
        volumeMounts:
        - name: html-content
          mountPath: /usr/share/nginx/html
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 15
          periodSeconds: 20
      volumes:
      - name: html-content
        configMap:
          name: frontend-service-html

---
# =============================================================================
# KUBERNETES SERVICE CONFIGURATION
# =============================================================================

apiVersion: v1
kind: Service
metadata:
  name: frontend-service
  namespace: default
  labels:
    app: frontend-service
    component: ai-credit-frontend
    version: v1.0.0
spec:
  selector:
    app: frontend-service
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    name: http
  type: LoadBalancer
  loadBalancerSourceRanges: []  # Allow access from all IPs
